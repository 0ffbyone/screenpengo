# Screenpen-Go

## Что умеет программа

### Рисование

#### Свободное рисование

Можно рисовать произвольные линии, которые получаются плавными благодаря интерполяции точек между движениями мыши. Толщину линии можно регулировать слайдером, а цвет выбирать через три RGB-слайдера для получения любого оттенка. При выборе цвета сразу видно квадратик-превью того цвета, который получится. Вокруг курсора отображается полупрозрачный круг, показывающий текущий размер кисти — это очень удобно для понимания, какой толщины будет линия. Размер круга мгновенно обновляется при изменении толщины на слайдере

#### Ластик

Ластик работает по-разному для разных объектов:

- Для обычных штрихов (свободного рисования) он стирает только ту область, по которой провели ластиком, как обычный школьный ластик
- Для геометрических фигур ластик работает иначе — он удаляет фигуру целиком, если коснулся её. Это сделано специально, потому что частично стёртая фигура обычно не нужна

Размер ластика регулируется тем же слайдером, что и толщина кисти. Когда режим ластика включён, кнопка подсвечивается ярко-синим цветом, чтобы было понятно, в каком режиме сейчас работаешь. Повторное нажатие на кнопку ластика выключает этот режим и возвращает к обычному рисованию.

### Геометрические фигуры

Реализовали четыре типа фигур, которые рисуются интерактивно — видно как они формируются в процессе:

**Круг**
Рисуется от центра: кликаешь в одну точку, тянешь мышь и видишь как растёт круг, отпускаешь — круг готов. Рисуется только окружность без заливки.

**Прямоугольник**
Стандартный прямоугольник по двум углам. Можно тянуть в любую сторону — координаты автоматически нормализуются. Рисуется только контур из четырёх линий.

**Линия**
Прямая линия от точки до точки. Использует тот же алгоритм толстых линий, что и обычное рисование.

**Стрелка**
Линия со стрелкой на конце. Размер наконечника пропорционален толщине линии, угол крыльев фиксированный (тридцать градусов). Направление стрелки вычисляется через тригонометрию по начальной и конечной точке.

Все фигуры используют текущий выбранный цвет и толщину. При выборе любой фигуры автоматически отключается режим ластика.

### Пользовательский интерфейс

Вся работа идёт через компактную боковую панель слева, которая вертикально отцентрирована. На ней расположены кнопки:

**Color** — открывает панель с тремя RGB-слайдерами и квадратиком предпросмотра цвета
**Width** — открывает слайдер для выбора толщины линии с отображением текущего значения
**Eraser** — включает/выключает режим ластика (подсвечивается синим когда активен)
**Shapes** — открывает панель выбора из четырёх фигур: круг, прямоугольник, линия, стрелка
**Save** — открывает диалог сохранения (зелёная кнопка)
**Load** — открывает диалог загрузки (синяя кнопка)

Панели с настройками появляются справа от кнопок и имеют полупрозрачный белый фон, чтобы были видны на любом фоне.

### Сохранение и загрузка

#### Сохранение

При нажатии на Save появляется диалоговое окно с текстовым полем. Можно ввести любое имя для проекта — например "презентация" или "урок-математика". Файл сохраняется в домашней директории в папке `.screenpen` в формате JSON. Расширение добавляется автоматически.

#### Загрузка

Диалог загрузки сделан удобно — показывает список всех ранее сохранённых файлов в виде кнопок. Просто кликаешь на нужный файл и он сразу загружается. Есть кнопка обновления списка (значок с круговой стрелкой) на случай если сохранил что-то в другой сессии. Также можно вручную ввести имя файла в текстовое поле, если точно знаешь как он называется.

Что именно сохраняется: все нарисованные штрихи с их цветами, толщинами и всеми точками, все созданные фигуры с их типами, цветами и позициями. Формат JSON выбран потому что его легко читать и при желании можно даже руками подправить.

### Горячие клавиши

Можно работать вообще без UI, только через клавиатуру — это быстрее во время презентаций.

**Цвета:**
R — красный, G — зелёный, B — синий, Y — жёлтый, O — оранжевый, P — розовый, X — размытие (полупрозрачный чёрный), E — ластик (белый)

**Толщина:**
1 — тонкая линия, 2 — средняя, 3 — толстая

**Действия:**
A — включить/выключить затемнение экрана
C — полностью очистить всё нарисованное
Esc — выход из программы

Важный момент: горячие клавиши работают только когда не открыты диалоги сохранения/загрузки. Когда диалог открыт, фокус клавиатуры передаётся текстовым полям, чтобы можно было вводить название файла.

## Архитектура

Код разделён на модули по назначению:

- **app** — координация всех компонентов, главный цикл обработки событий и отрисовки
- **canvas** — хранение и управление штрихами и фигурами, сохранение и загрузка в JSON
- **input** — обработка событий клавиатуры и мыши
- **render** — отрисовка всего через Gio
- **tool** — конфигурация инструментов (перо, фигуры)
- **ui** — панель инструментов и диалоги

Рендеринг идёт послойно через систему Stack в Gio: сначала прозрачный фон, потом опционально затемнение, потом все штрихи, потом все фигуры, потом курсор, и в самом конце UI-панель поверх всего.

## Особенности реализации

### Плавность линий

Между событиями движения мыши добавляются промежуточные точки через интерполяцию, иначе при быстром движении линия получается прерывистой. Расстояние между точками привязано к толщине линии.

### Как работает ластик для фигур

Когда проводишь ластиком, программа смотрит все точки по которым прошёл ластик, и для каждой проверяет не попала ли она в область какой-нибудь фигуры. Для проверки используется расширенный bounding box (ограничивающий прямоугольник). Если хоть одна точка попала — фигура удаляется целиком.

### Рисование толстых линий

Толстые линии рисуются как серия маленьких кругов расположенных вплотную друг к другу вдоль линии. Количество кругов рассчитывается по длине линии, чтобы не было пробелов.

### Отрисовка стрелок

Стрелка — это линия плюс два крыла на конце. Позиции крыльев вычисляются математически: берётся вектор направления стрелки, поворачивается на тридцать градусов в одну и другую сторону, и от конца стрелки рисуются две линии в эти направления.

### Команды

```bash
make help     # Показать справку
make build    # Собрать программу
make run      # Собрать и запустить
make clean    # Удалить скомпилированные файлы
```

## Как пользоваться

**Быстрый старт:**

1. Запустить программу командой `make run`
2. Выбрать цвет через кнопку Color или клавишу (например R для красного)
3. Выбрать толщину через кнопку Width или клавиши 1/2/3
4. Просто рисовать мышкой — нажать, тянуть, отпустить
5. Сохранить через кнопку Save, дав проекту имя

**Для рисования фигур:**

1. Нажать Shapes, выбрать нужную фигуру
2. Кликнуть в начальную точку, тянуть мышь
3. Фигура рисуется интерактивно — видно что получается
4. Отпустить мышь — фигура зафиксирована

**Для стирания:**

1. Нажать Eraser (или клавишу E)
2. Провести по тому что надо стереть
3. Штрихи сотрутся частично, фигуры удалятся целиком
4. Повторное нажатие Eraser вернёт к рисованию

**Для загрузки:**

1. Нажать Load
2. Кликнуть на нужный файл из списка
3. Или ввести название вручную и нажать кнопку Load

## Структура проекта

```
screenpengo/
├── cmd/screenpen-go/         # Точка входа программы
├── internal/
│   ├── app/                  # Главная логика приложения
│   ├── canvas/               # Работа с рисунками
│   ├── input/                # Обработка ввода
│   ├── render/               # Отрисовка
│   ├── tool/                 # Настройки инструментов
│   └── ui/                   # Интерфейс
├── Makefile
└── README.md
```
